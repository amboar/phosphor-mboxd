TEST_MBOX_VPNOR_SRCS = common.c pnor_partition_table.cpp \
		       %reldir%/tmpd.cpp

VPNOR_LDADD = -lstdc++fs \
	$(SDBUSPLUS_LIBS) \
	$(PHOSPHOR_LOGGING_LIBS) \
	$(PHOSPHOR_DBUS_INTERFACES_LIBS)

test_vpnor_create_pnor_partition_table_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) \
	$(TEST_MOCK_SRCS) \
	mboxd_msg.c \
	mboxd_windows.c \
	mboxd_lpc.c \
	mboxd_lpc_virtual.cpp \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	pnor_partition.cpp \
	%reldir%/create_pnor_partition_table.cpp
test_vpnor_create_pnor_partition_table_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_create_pnor_partition_table_LDADD = $(VPNOR_LDADD)

test_vpnor_create_read_window_partition_exists_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) $(TEST_MOCK_SRCS) \
	mboxd_msg.c \
	mboxd_windows.c \
	mboxd_lpc.c \
	mboxd_lpc_virtual.cpp \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	pnor_partition.cpp \
	%reldir%/create_read_window_partition_exists.cpp
test_vpnor_create_read_window_partition_exists_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_create_read_window_partition_exists_LDADD = $(VPNOR_LDADD)

test_vpnor_write_patch_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	mtd.c \
	pnor_partition.cpp \
	%reldir%/write_patch.cpp
test_vpnor_write_patch_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_write_patch_LDADD = $(VPNOR_LDADD)

test_vpnor_write_prsv_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	mtd.c \
	pnor_partition.cpp \
	%reldir%/write_prsv.cpp
test_vpnor_write_prsv_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_write_prsv_LDADD = $(VPNOR_LDADD)

test_vpnor_write_ro_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	mtd.c \
	pnor_partition.cpp \
	%reldir%/write_ro.cpp
test_vpnor_write_ro_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_write_ro_LDADD = $(VPNOR_LDADD)

test_vpnor_write_rw_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	mtd.c \
	pnor_partition.cpp \
	%reldir%/write_rw.cpp
test_vpnor_write_rw_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_write_rw_LDADD = $(VPNOR_LDADD)

test_vpnor_toc_no_name_SOURCES = \
	common.c \
	pnor_partition_table.cpp \
	%reldir%/toc_no_name.cpp
test_vpnor_toc_no_name_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_toc_no_name_LDADD = $(VPNOR_LDADD)

test_vpnor_toc_start_gt_end_SOURCES = \
	common.c \
	pnor_partition_table.cpp \
	%reldir%/toc_start_gt_end.cpp
test_vpnor_toc_start_gt_end_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_toc_start_gt_end_LDADD = $(VPNOR_LDADD)

test_vpnor_toc_no_start_SOURCES = \
	common.c \
	pnor_partition_table.cpp \
	%reldir%/toc_no_start.cpp
test_vpnor_toc_no_start_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_toc_no_start_LDADD = $(VPNOR_LDADD)

test_vpnor_toc_no_end_SOURCES = \
	common.c \
	pnor_partition_table.cpp \
	%reldir%/toc_no_end.cpp
test_vpnor_toc_no_end_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_toc_no_end_LDADD = $(VPNOR_LDADD)

test_vpnor_toc_no_version_SOURCES = \
	common.c \
	pnor_partition_table.cpp \
	%reldir%/toc_no_version.cpp
test_vpnor_toc_no_version_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_toc_no_version_LDADD = $(VPNOR_LDADD)

test_vpnor_toc_flags_SOURCES = \
	common.c \
	pnor_partition_table.cpp \
	%reldir%/toc_flags.cpp
test_vpnor_toc_flags_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_toc_flags_LDADD = $(VPNOR_LDADD)

test_vpnor_toc_overlap_SOURCES = \
	$(TEST_MOCK_SRCS) \
	mboxd_msg.c \
	mboxd_windows.c \
	mboxd_lpc.c \
	mboxd_lpc_virtual.cpp \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	pnor_partition.cpp \
	common.c \
	pnor_partition_table.cpp \
	%reldir%/toc_overlap.cpp
test_vpnor_toc_overlap_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_toc_overlap_LDADD = $(VPNOR_LDADD)

test_vpnor_toc_lookup_found_SOURCES = \
	$(TEST_MOCK_SRCS) \
	mboxd_msg.c \
	mboxd_windows.c \
	mboxd_lpc.c \
	mboxd_lpc_virtual.cpp \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	pnor_partition.cpp \
	common.c \
	pnor_partition_table.cpp \
	%reldir%/toc_lookup_found.cpp
test_vpnor_toc_lookup_found_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_toc_lookup_found_LDADD = $(VPNOR_LDADD)

test_vpnor_toc_lookup_failed_SOURCES = \
	$(TEST_MOCK_SRCS) \
	mboxd_msg.c \
	mboxd_windows.c \
	mboxd_lpc.c \
	mboxd_lpc_virtual.cpp \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	pnor_partition.cpp \
	common.c \
	pnor_partition_table.cpp \
	%reldir%/toc_lookup_failed.cpp
test_vpnor_toc_lookup_failed_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_toc_lookup_failed_LDADD = $(VPNOR_LDADD)

test_vpnor_toc_missing_file_SOURCES = \
	$(TEST_MOCK_SRCS) \
	mboxd_msg.c \
	mboxd_windows.c \
	mboxd_lpc.c \
	mboxd_lpc_virtual.cpp \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	pnor_partition.cpp \
	common.c \
	pnor_partition_table.cpp \
	%reldir%/toc_missing_file.cpp
test_vpnor_toc_missing_file_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_toc_missing_file_LDADD = $(VPNOR_LDADD)

test_vpnor_create_read_window_oob_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) $(TEST_MOCK_SRCS) \
	mboxd_msg.c \
	mboxd_windows.c \
	mboxd_lpc.c \
	mboxd_lpc_virtual.cpp \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	pnor_partition.cpp \
	%reldir%/create_read_window_oob.cpp
test_vpnor_create_read_window_oob_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_create_read_window_oob_LDADD = $(VPNOR_LDADD)

test_vpnor_create_read_window_toc_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) $(TEST_MOCK_SRCS) \
	mboxd_msg.c \
	mboxd_windows.c \
	mboxd_lpc.c \
	mboxd_lpc_virtual.cpp \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	pnor_partition.cpp \
	%reldir%/create_read_window_toc.cpp
test_vpnor_create_read_window_toc_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_create_read_window_toc_LDADD = $(VPNOR_LDADD)

test_vpnor_create_read_window_straddle_partitions_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) $(TEST_MOCK_SRCS) \
	mboxd_msg.c \
	mboxd_windows.c \
	mboxd_lpc.c \
	mboxd_lpc_virtual.cpp \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	pnor_partition.cpp \
	%reldir%/create_read_window_straddle_partitions.cpp
test_vpnor_create_read_window_straddle_partitions_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_create_read_window_straddle_partitions_LDADD = $(VPNOR_LDADD)

test_vpnor_create_read_window_partition_invalid_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) $(TEST_MOCK_SRCS) \
	mboxd_msg.c \
	mboxd_windows.c \
	mboxd_lpc.c \
	mboxd_lpc_virtual.cpp \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	pnor_partition.cpp \
	%reldir%/create_read_window_partition_invalid.cpp
test_vpnor_create_read_window_partition_invalid_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_create_read_window_partition_invalid_LDADD = $(VPNOR_LDADD)

test_vpnor_read_patch_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) $(TEST_MOCK_SRCS) \
	mboxd_msg.c \
	mboxd_windows.c \
	mboxd_lpc.c \
	mboxd_lpc_virtual.cpp \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	pnor_partition.cpp \
	%reldir%/read_patch.cpp
test_vpnor_read_patch_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_read_patch_LDADD = $(VPNOR_LDADD)

test_vpnor_write_patch_resize_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	mtd.c \
	pnor_partition.cpp \
	%reldir%/write_patch_resize.cpp
test_vpnor_write_patch_resize_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_write_patch_resize_LDADD = $(VPNOR_LDADD)

test_vpnor_dump_flash_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) $(TEST_MOCK_SRCS) \
	mboxd_msg.c \
	mboxd_windows.c \
	mboxd_lpc.c \
	mboxd_lpc_virtual.cpp \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	pnor_partition.cpp \
	%reldir%/dump_flash.cpp
test_vpnor_dump_flash_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_dump_flash_LDADD = $(VPNOR_LDADD)

test_vpnor_create_read_window_size_SOURCES = \
	$(TEST_MBOX_VPNOR_SRCS) $(TEST_MOCK_SRCS) \
	mboxd_msg.c \
	mboxd_windows.c \
	mboxd_lpc.c \
	mboxd_lpc_virtual.cpp \
	mboxd_pnor_partition_table.cpp \
	mboxd_flash_virtual.cpp \
	pnor_partition.cpp \
	%reldir%/create_read_window_size.cpp
test_vpnor_create_read_window_size_LDFLAGS = $(OESDK_TESTCASE_FLAGS)
test_vpnor_create_read_window_size_LDADD = $(VPNOR_LDADD)

if VIRTUAL_PNOR_ENABLED
check_PROGRAMS += \
	%reldir%/create_pnor_partition_table \
	%reldir%/create_read_window_partition_exists \
	%reldir%/write_prsv \
	%reldir%/write_ro \
	%reldir%/write_rw \
	%reldir%/write_patch \
	%reldir%/toc_no_name \
	%reldir%/toc_start_gt_end \
	%reldir%/toc_no_start \
	%reldir%/toc_no_end \
	%reldir%/toc_no_version \
	%reldir%/toc_flags \
	%reldir%/toc_overlap \
	%reldir%/toc_lookup_found \
	%reldir%/toc_lookup_failed \
	%reldir%/toc_missing_file \
	%reldir%/create_read_window_oob \
	%reldir%/create_read_window_toc \
	%reldir%/create_read_window_straddle_partitions \
	%reldir%/create_read_window_partition_invalid \
	%reldir%/read_patch \
	%reldir%/write_patch_resize \
	%reldir%/dump_flash \
	%reldir%/create_read_window_size

XFAIL_TESTS += %reldir%/dump_flash
XFAIL_TESTS += %reldir%/create_read_window_size
endif
